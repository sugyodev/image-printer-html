<!DOCTYPE html>
<html>

<head>
    <title>Alrajhi-capital</title>
    <link rel="stylesheet" href="./css/index.css" />
    <script src="./js/dom-to-image.min.js"></script>

    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
    </head>
</head>

<body>
    <div class="header"></div>
    <div style="height: 100vh;">
        <div id="content">
            <img src="./imgs/logo-horizon.png" id="logo1">
            <img src="./imgs/logo-vertical.png" id="logo2">
            <div class="form-group">
                <p for="str1">الاسم</p>
                <input type="text" name="str1" id="str1" style="direction:rtl">
            </div>
            <div class="form-group">
                <p for="str2">Name</p>
                <input type="text" name="str2" id="str2" style="direction:rtl">
            </div>
            <div>
                <p id="picker-label">Select font</p>
                <div style="display:flex;">
                    <input type="color" value="#ffffff" id="color-picker">
                    <select name="font-size" id="font-size">
                        <option value="8">8</option>
                        <option value="10">10</option>
                        <option value="12">12</option>
                        <option value="14">14</option>
                        <option value="16">16</option>
                        <option value="18">18</option>
                        <option value="20">20</option>
                        <option value="24" selected="selected">24</option>
                        <option value="28">28</option>
                        <option value="32">32</option>
                        <option value="36">36</option>
                        <option value="40">40</option>
                        <option value="44">44</option>
                        <option value="48">48</option>
                        <option value="52">52</option>
                    </select>
                </div>
            </div>
            <a id="print" href="#">
                <p>طباعة Save</p><span class="loader"></span>
            </a>
        </div>
    </div>

    <div id="result">
        <img src="" id="result-bg">
        <!-- <div id="result-link">alrahi-capital.com</div> -->
        <div class="result-text">
            <p id="result-text1"></p>
            <p id="result-text2"></p>
        </div>
    </div>
</body>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        var resultBg = document.getElementById('result-bg');
        var loader = document.getElementsByClassName('loader')[0];

        var urlParams = new URLSearchParams(window.location.search);
        var imgSrc = urlParams.get('url');
        resultBg.src = atob(imgSrc);

        var picker = document.getElementById('color-picker');
        var sizePicker = document.getElementById('font-size');

        // var pickerLabel = document.getElementById('picker-label');
        var resultText = document.getElementsByClassName('result-text')[0];

        sizePicker.onchange = function(e){
            resultText.style.fontSize = e.target.value + 'px';
        }

        picker.onchange = function (e) {
            resultText.style.color = e.target.value;
        }

        var printCanvas, resultTextValue1, resultTextValue2, uploadedBg;
        var str1Input = document.getElementById('str1');
        var str2Input = document.getElementById('str2');

        var resultEle = document.getElementById('result');
        var printBtn = document.getElementById('print');
        var resultText1 = document.getElementById('result-text1');
        var resultText2 = document.getElementById('result-text2');

        str1Input.onchange = function (e) {
            resultTextValue1 = e.target.value;
        }

        str2Input.onchange = function (e) {
            resultTextValue2 = e.target.value;
        }

        resultBg.onload = function () {
            console.log('loaded successfully');
            printBtn.onclick = function () {
                if (!imgSrc) { alert('You should use generated url.'); return; }
                else {
                    if (!resultTextValue1 || !resultTextValue2) { alert('You must fill out all fields.'); return; }
                    else {
                        resultText1.innerText = resultTextValue1;
                        resultText2.innerText = resultTextValue2;
                        loader.style.display = 'inline-block';
                        domtoimage.toPng(resultEle)
                            .then(function (dataUrl) {
                                str1Input.value = "";
                                str2Input.value = "";
                                resultTextValue1 = "";
                                resultTextValue2 = "";

                                var a = document.createElement("a"); //Create <a>
                                a.href = dataUrl;//Image Base64 Goes here
                                a.download = "card.png"; //File name Here
                                loader.style.display = 'none';
                                a.click();
                            })
                            .catch(function (error) {
                                console.error('oops, something went wrong!', error);
                                loader.style.display = 'none';
                            });
                    }
                }
            }
        }

    }, { once: true });

</script>

</html>